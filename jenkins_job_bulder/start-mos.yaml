#git clone plugin, build cinder-nfs-plugin
- job:
    name: cinder-nfs-plugin-build
    project-type: freestyle
    defaults: global
    description: |
      <p><b>This job is managed automatically and will be overwritten.</b></p>
      <p><b>Do not edit this job through the web</b></p>
      <p>If you would like to make changes to this job, please see:
        <a href="https://github.com/vkuspits/cinder-nfs-ci-config">
          https://github.com/vkuspits/cinder-nfs-ci-config
        </a>
      </p>
    disabled: false

    builders:
    - shell: |
            sudo apt-get install createrepo rpm dpkg-dev
            sudo pip install fuel-plugin-builder
            rm -rf cinder-nfs-plugin
            git clone https://github.com/vkuspits/cinder-nfs-plugin
            fpb --build cinder-nfs-plugin

#Create MOS env via fuel-devops
- job:
    name: env-config
    project-type: freestyle
    defaults: global
    description: |
      <p><b>This job is managed automatically and will be overwritten.</b></p>
      <p><b>Do not edit this job through the web</b></p>
      <p>If you would like to make changes to this job, please see:
        <a href="https://github.com/vkuspits/cinder-nfs-ci-config">
          https://github.com/vkuspits/cinder-nfs-ci-config
        </a>
      </p>
    disabled: false
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true
      - trigger:
           project: 'cinder-nfs-plugin-build'
    builders:
      - shell: |
          scp -i rsa $WORKSPACE/cinder-nfs-ci-config 172.18.66.28:/tmp 
          ssh -i rsa root@172.18.66.28
          puppet apply /tmp/cinder-nfs-ci-config/puppet/manifest/site.pp
#Copy>install>deploy cinder-nfs-plugin
- job:
    name: deploy-plugin
    project-type: freestyle
    defaults: global
    description: |
      <p><b>This job is managed automatically and will be overwritten.</b></p>
      <p><b>Do not edit this job through the web</b></p>
      <p>If you would like to make changes to this job, please see:
        <a href="https://github.com/vkuspits/cinder-nfs-ci-config">
          https://github.com/vkuspits/cinder-nfs-ci-config
        </a>
      </p>
    disabled: false
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true
      - trigger:
           project: 'env-config'
    builders:
      - shell: |
          #переписать установку венва на слейва, а не в папку дженкинса
          puppet apply $WORKSPACE/cinder-nfs-ci-config/puppet/manifest/ssh-to-master.pp
          scp $WORKSPACE/cinder-nfs-ci-config/cinder-nfs-plugin/nfs-* root@10.10.0.2:/tmp
          scp $WORKSPACE/cinder-nfs-ci-config/python/settings.py root@10.10.0.2:/tmp
          ssh root@10.10.0.2
          openstack-env.sh
- job:
    name: deploy-success
    project-type: freestyle
    defaults: global
    description: |
      <p><b>This job is managed automatically and will be overwritten.</b></p>
      <p><b>Do not edit this job through the web</b></p>
      <p>If you would like to make changes to this job, please see:
        <a href="https://github.com/vkuspits/cinder-nfs-ci-config">
          https://github.com/vkuspits/cinder-nfs-ci-config
        </a>
      </p>
    disabled: false
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true
      - trigger:
           project: 'deploy-plugin'
    builders:
      - shell: |
          echo "deploy-plugin succesfull" >> $WORKSPACE/cinder-nfs-plugin/job_result

- project:
    name: start-mos
    mos:
      - '9.0'
    jobs:
      - 'cinder-nfs-plugin-build'
      - 'env-config'
      - 'deploy-plugin'
      - 'deploy-success'